#+TITLE: Apache Log Analysis

<%= render "summary.txt.erb", data: data %>

<% @reports.each do |report| %>
** <%= report[:title] %>

<%= render "output_table.txt.erb", report: report, data: data %>
<% end %>

** Geolocation

<%=
ips = data[:ips].group_by { |x| x[4] }.map { |k, v|
  [k, v.map { |x| x[1] }.inject(&:+), v.map { |x| x[2] }.inject(&:+) ]
}
table = Terminal::Table.new headings: ["Country", "Hits", "Total Visits"], rows: ips
table.style border_i: "|"
table
%>

** Command Invocation

<%= render 'command_invocation.txt.erb', data: data %>

** Performance

<%= render 'performance.txt.erb', data: data %>

