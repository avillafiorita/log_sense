* Apache Log Analysis

<%= render "summary.txt.erb", data: data %>

<% @reports.each do |report| %>
** <%= report[:title] %>

<%=
shortened = Emitter::shorten(report[:rows], report[:header], @data[:width])
table = Terminal::Table.new headings: report[:header], rows: shortened
(0..report[:header].size - 1).map { |i| table.align_column(i, report[:column_alignment][i] || :left) }
table
%>
<% end %>

** Geolocation

<%=
ips = data[:ips].group_by { |x| x[4] }.map { |k, v|
  [k, v.map { |x| x[1] }.inject(&:+), v.map { |x| x[2] }.inject(&:+) ]
}
table = Terminal::Table.new headings: ["Country", "Hits", "Total Visits"], rows: ips
table
%>

** Command Invocation

<%= render 'command_invocation.txt.erb', data: data %>

** Performance

<%= render 'performance.txt.erb', data: data %>

